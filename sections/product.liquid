{%- assign current_variant = product.selected_or_first_available_variant -%}
{%- assign featured_image = current_variant.featured_image | default: product.featured_image -%}
{%- assign artist_handle = product.vendor | handleize -%}
{%- assign active_product = product.title -%}


{% assign template_type = "" %}
{% assign gallery = "" %}
{% assign ungoals = "" %}
{% assign artist = "" %}

{% for collection in product.collections %}

    {% assign template_type = collection.template_suffix | strip %}

    {% if template_type == 'gallery' %}
        {% assign gallery = collection %}
    {% elsif template_type == 'ungoals' %}
        {% assign ungoals = collection %}
    {% elsif template_type == 'artist' %}
        {% assign artist = collection %}
    {% endif %}

{% endfor %}

<section class="single__product">
    <div class="row">
        <div class="col-md-6 product__images">
            <div class="product__images__featured">
                <img id="product-image" data-mfp-src="{{ featured_image | img_url: '720x720' }}" src="{{ featured_image | img_url: '720x720' }}" alt="{{ featured_image.alt | escape }}" data-product-featured-image>
            </div>

            {%- if product.images.size > 1 -%}
                <div class="product__images-thumbnail">
                    {% for image in product.images %}
                    <a class="preview-thumbnail" href="{{ image.src | img_url: '720x720' }}" data-product-single-thumbnail>
                        <img class="gallery-img" data-mfp-src="{{ image.src | img_url: '720x720' }}" src="{{ image.src | img_url: '160x160' }}" alt="{{ image.alt | escape }}">
                    </a>
                    {% endfor %}
                </div>
            {%- endif -%}

        </div>
        <div class="col-md-6 product__meta bg--white">

            <h3 class="vendor">{{ artist.title }}</h3>
            <h1 class="product__title">{{ product.title }}{% if product.metafields.product.date %}, {{ product.metafields.product.date | date: "%Y" }}{% endif %}</h1>

            <div class="price">
                {%- if current_variant.available -%}
                {{ current_variant.price | money }}
                {%- else -%}
                SOLD OUT
                {%- endif -%}
            </div>

            {%- if current_variant.available -%}
                <div class="price__impact">
                    {{ section.settings.impact }} {{ current_variant.price | times: 0.9 | money }}
                </div>
            {%- endif -%}

            <div class="shipping-info">
                <span>Ships from David Zwirner, New York, NY, USA</span>
                <span>Shipping: $190 domestic; $419 worldwide</span>
            </div>

            {% capture "form_classes" -%}
            product-form product-form-{{ section.id }}
            {%- unless section.settings.show_variant_labels %} product-form--hide-variant-labels {% endunless %}
            {%- if section.settings.enable_payment_button and product.has_only_default_variant %} product-form--payment-button-no-variants {%- endif -%}
            {%- if current_variant.available == false %} product-form--variant-sold-out {%- endif -%}
            {%- endcapture %}

            {% form 'product', product, class:form_classes, novalidate: 'novalidate', data-product-form: '' %}

                <div class="product-form__controls-group product-form__controls-group--submit">
                    <div class="product-form__item product-form__item--submit
                    {%- if section.settings.enable_payment_button %} product-form__item--payment-button {%- endif -%}
                    {%- if product.has_only_default_variant %} product-form__item--no-variants {%- endif -%}"
                    >
                        <button type="submit" name="add"
                        {% unless current_variant.available %} aria-disabled="true"{% endunless %}
                        aria-label="{% unless current_variant.available %}{{ 'products.product.sold_out' | t }}{% else %}{{ 'products.product.add_to_cart' | t }}{% endunless %}"
                        class="btn product-form__cart-submit{% if section.settings.enable_payment_button %} btn--secondary-accent{% endif %}"
                        {% if settings.enable_ajax %}aria-haspopup="dialog"{% endif %}
                        data-add-to-cart>
                            <span data-add-to-cart-text>
                                {% unless current_variant.available %}
                                {{ 'products.product.sold_out' | t }}
                                {% else %}
                                {{ 'products.product.add_to_cart' | t }}
                                {% endunless %}
                            </span>
                            <span class="hide" data-loader>
                                {% include 'icon-spinner' %}
                            </span>
                        </button>
                        {% if section.settings.enable_payment_button %}
                            {{ form | payment_button }}
                        {% endif %}
                    </div>
                </div>
            {% endform %}
        </div>
    </div>
</section>

<section class="about">
    <div class="row">
        <div class="col-lg-6">
            <div class="about__artist">
                <h2>About {{ artist.title }}</h2>
                <a href="{{artist.url}}">Artist Profile</a>
                <p><strong>Born:</strong> {{artist.metafields.artist.born}}</p>
                <p><strong>Studio:</strong> {{artist.metafields.artist.studio}}</p>
                <p>
                    {{ artist.description | prepend: "<strong>Short Bio: </strong>" }}
                </p>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="about__art-piece">
                <h2>About the Piece</h2>
                <table class="product-datas__table">
                    <tbody>
                        <tr>
                            <th>Signature</th>
                            <td>{{ product.metafields.product.signature }}</td>
                        </tr>
                        <tr>
                            <th>Certificate of authenticity</th>
                            <td>{{ product.metafields.product.certificate_of_authenticity }}</td>
                        </tr>
                        <tr>
                            <th>Frame</th>
                            <td>{{ product.metafields.accentuate.frame }}</td>
                        </tr>
                        <tr>
                            <th>Shipping</th>
                            <td>Learn more</td>
                        </tr>
                        <tr>
                            <th>Tax Legislation</th>
                            <td>Select your country</td>
                        </tr>

                    </tbody>
                </table>
            </div>

            <div class="about__gallery">

                <h2>About {{ gallery.title }}</h2>
                <a href="{{gallery.urll}}">Gallery Profile</a>
                <p>{{gallery.description}}</p>
            </div>

            <div class="about__impact bg--gray">
                <h2>Your Impact</h2>
                <p>
                    {{ current_variant.price | times: 0.9 | money }} of your purchase will directly support one of the following goals:
                </p>

                <div class="impact-logos">

                    {% assign sdg = product.collections | sort: "title" %}

                    {% for collection in sdg %}

                        {% assign template_type = collection.template_suffix | strip %}

                        {% if template_type == 'ungoals' %}

                            {% for image in collection.metafields.accentuate.choice_logo %}
                              <img class="impact-logo" src="{{ image.cloudinary_src | append: 'w_115,h_115' }}" alt="{{ collection.title }}"/>
                            {% endfor %}

                        {% endif %}

                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>

<section class="collection collection__featured collection__artist">
    <div class="row">
        <div class="col-12">
            <h2>Other Works by {{ artist.title }}</h2>
            <a class="cta" href="{{ artist.url }}">View All</a>
            <div class="collection-items featured-items">
                {% for product in artist.products %}

                    {% include 'partial-product-card' %}

                {% endfor %}
            </div>
        </div>
    </div>
</section>

<section class="collection collection__featured collection__artist">
    <div class="row">
        <div class="col-12">
            <h2>Other Works From {{ gallery.title }}</h2>
            <a class="cta" href="{{ gallery.url }}">View All</a>
            <div class="collection-items featured-items">
                {% for product in gallery.products %}

                    {% include 'partial-product-card' %}

                {% endfor %}
            </div>
        </div>
    </div>
</section>


<script>
const thumbnails = document.getElementsByClassName('preview-thumbnail');
const previewImg = document.getElementById('product-image');
for (var i = 0, len = thumbnails.length; i < len; i++) {
    const currentThumb = thumbnails[i];
    currentThumb.addEventListener('click', (e) => {
        e.preventDefault();
        previewImg.src = currentThumb.href;
    });
}
$(document).ready(function() {
    if ($('.product__images__thumbnail a').length>1) {
        $('#product-image').click(function() {
            $('.gallery-img:first').click()[0];
        });
        $('.gallery-img').magnificPopup({
            type: 'image',
            gallery: {
                enabled: true
            }
        });
    } else {
        $('#product-image').magnificPopup({
            type:'image'
        });
    }
});
</script>


{% schema %}
{
    "name": "Product",
    "settings": [
    {
        "type": "text",
        "id": "impact",
        "label": "Your Impact Title",
        "default": "Your impact: "
    },

    {
        "type": "textarea",
        "id": "delivery",
        "label": "Delivery Text"
    }
    ]
}
{% endschema %}
